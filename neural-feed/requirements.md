# NEURAL FEED — 要件定義書

> 作成日: 2026-02-22
> 最終更新: 2026-02-22
> ブランチ: `claude/neural-feed-led-app-wZivB`
> 関連: `watson-news/requirements.md`

---

## 1. プロダクト概要

### 1.1 コンセプト

クローラーが収集したニュース記事をAIが処理する様子を、**神経回路網のリアルタイムアニメーション**として可視化するLEDスクリーン専用Webアプリケーション。IBMのAI技術力・情報処理能力を来場者に体感させる「近未来型インフォメーションウォール」。

### 1.2 位置づけ

| 項目 | Watson News RAG UI | NEURAL FEED |
|---|---|---|
| 目的 | 社内ユーザーが記事を検索・分析する | 来場者にAI処理をリアルタイムで可視化する |
| 操作 | 双方向（検索・フィルタ・RAG問い合わせ） | 一方向（自動再生・表示専用） |
| UIデザイン | IBM Carbon Design System | 近未来的・シネマティック |
| データソース | OpenSearch（enrichedレイヤー） | **同一のOpenSearch**（enrichedレイヤー） |
| 実装 | Next.js + Starlette | 独立した専用Webアプリ |

### 1.3 表示環境

| 項目 | 仕様 |
|---|---|
| スクリーン種別 | 4K LEDスクリーン × 2面（横並び） |
| 解像度 | 7680 × 2160 px（横8K相当） |
| 表示可能エリア | 7680 × 1890 px（上下各135pxは非表示） |
| 想定視聴距離 | 3〜10 m（来場者立ち見） |
| 連続稼働時間 | 8時間以上（展示会・イベント期間中） |
| 操作 | 不要（自動ループ再生） |

---

## 2. 画面仕様

### 2.1 セーフエリア制御

ルート要素に以下のスタイルを適用し、LEDの非表示エリア（上下各135px）への重要情報の描画を防ぐ。背景のパーティクルや装飾的エフェクトは全画面（2160px）に描画して没入感を高める。

```css
.safe-area-container {
  width: 7680px;
  height: 1890px; /* 2160px - 135px(上) - 135px(下) */
  margin-top: 135px;
  position: relative;
  overflow: hidden;
}
```

| レイヤー | 描画エリア | 内容 |
|---|---|---|
| 背景レイヤー | 7680 × 2160 px（全画面） | パーティクル・光の漏れ・グロー |
| コンテンツレイヤー | 7680 × 1890 px（セーフエリア） | テキスト・グラフ・UI要素 |

### 2.2 3パネルレイアウト

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  [BACKGROUND: パーティクル・グロー エフェクト / 7680×2160px]               │
│ ┌─────────────────────────────────────────────────────────────────────────┐ │
│ │  SAFE AREA  7680×1890px  (margin-top: 135px)                           │ │
│ │ ┌─────────────────┬──────────────────────────┬───────────────────────┐ │ │
│ │ │   LEFT PANEL    │     CENTER PANEL          │    RIGHT PANEL        │ │ │
│ │ │   〜1920px      │     〜3840px              │    〜1920px           │ │ │
│ │ │                 │                           │                       │ │ │
│ │ │ Watson NLU      │  Neural Graph             │  Article Queue        │ │ │
│ │ │ Processing      │  (Three.js + d3-force)    │  & Classification     │ │ │
│ │ │ Pipeline        │                           │                       │ │ │
│ │ └─────────────────┴──────────────────────────┴───────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 機能要件

### 3.1 左パネル — Watson NLU 処理パイプライン

#### 3.1.1 7ステップパイプライン表示

AIが1件の記事を処理する7段階のワークフローをリアルタイムで可視化する。各ステップには4種類の状態がある。

| ステップ番号 | ステップ名 | 処理内容 |
|---|---|---|
| 1 | Article Ingestion | クローラーからの記事受信 |
| 2 | Language Detection | 言語識別（en / ja） |
| 3 | Tokenization | 形態素解析・トークン分割 |
| 4 | Sentiment Scoring | 感情スコア算出（-1.0〜1.0） |
| 5 | Entity Extraction | 固有表現抽出（人名・組織・場所） |
| 6 | Topic Classification | トピック分類（Politics / Tech / Finance 等） |
| 7 | Conflict Flag Detection | 対立・緊張トピックの検出 |

#### 3.1.2 ステップ状態定義

| 状態 | 表示色 | 記号 | 意味 |
|---|---|---|---|
| DONE | 緑（`#42be65`） | 🟢 | 処理完了 |
| ACTIVE | 青（`#0f62fe`） | 🔵 | 処理中（アニメーション） |
| QUEUE | グレー（`#525252`） | ⬜ | 待機中 |
| ALERT | オレンジ（`#ff832b`） | 🟠 | 警告・要注意フラグ |

ACTIVE 状態のステップはプログレスバーとスキャンラインアニメーションで「処理中」を表現する。

#### 3.1.3 KPIメトリクス表示

| メトリクス | 説明 |
|---|---|
| スループット | 処理速度（art/min）。OpenSearchへの取り込みレートから算出 |
| Watson接続状態 | バックエンドAPI + OpenSearch の死活状態 |
| 本日の取り込み記事数 | その日の `watson_news_enriched` へのインデックス件数 |
| アクティブソース数 | 現在データを提供しているコネクタ数（GDELT / IBM公式 / Box） |

---

### 3.2 中央パネル — ニューラルグラフ

#### 3.2.1 グラフ構造

**Three.js（WebGL）+ d3-force** で構築する3Dノードグラフ。

| 要素 | 仕様 |
|---|---|
| 総ノード数 | 最大500ノード（60fps維持） |
| ハブノード | 中央に1個。「Watson NLU Core Engine」を表現。同心円リングで発光 |
| クラスターノード | 7クラスター（INPUT / PARSE / SENTIMENT / TOPIC / ENTITY / CONFLICT / OUTPUT） |
| 末端ノード | 記事・エンティティ・トピックを表現する小ノード |
| エッジ | ノード間を繋ぐ半透明ライン。処理フロー方向に沿って信号ドットが流れる |

#### 3.2.2 クラスター定義

| クラスターID | 意味 | 代表カラー |
|---|---|---|
| INPUT | 記事受信（GDELT / IBM公式 / Box） | `#6fdc8c`（緑） |
| PARSE | 言語検出・トークン化 | `#82cfff`（水色） |
| SENTIMENT | 感情スコアリング | `#ffafd2`（ピンク） |
| TOPIC | トピック分類 | `#d4bbff`（紫） |
| ENTITY | エンティティ抽出 | `#ffd6a5`（黄橙） |
| CONFLICT | コンフリクト検出 | `#ff8389`（赤） |
| OUTPUT | インデックス完了・出力 | `#ffffff`（白） |

#### 3.2.3 アニメーション仕様

| アニメーション | 説明 |
|---|---|
| ノード発火 | 新規記事が取り込まれると、INPUTクラスタのノードがパルス発光 |
| シグナルドット | エッジ上を粒子が流れ、処理の進行を表現。処理速度に応じて速くなる |
| フォーリングラベル | 分類ラベル（`CONFLICT▼` / `POLITICS▼` / `TECH▼` 等）が画面上部から降ってくる |
| ハブ発光 | 中央ハブは常時ゆっくりと脈打つように明滅する（`sin` 波ベース） |
| カメラ回転 | Three.jsカメラがゆっくりとグラフ周囲を公転（自動・ループ） |
| ノード位置更新 | 新記事追加時に d3-force が再計算し、ノードがゆっくり移動する |

#### 3.2.4 ノードデータマッピング

| ノード種別 | データソース | 追加タイミング |
|---|---|---|
| 記事ノード | `watson_news_enriched.id` | 新規記事インデックス時 |
| エンティティノード | `watson_news_enriched.entities[].text` | 記事に含まれる固有表現 |
| トピックノード | `watson_news_enriched.topic` | 分類結果ラベルごと |

---

### 3.3 右パネル — 記事キューと分類結果

#### 3.3.1 記事キュー

直近で受信・処理中の記事一覧をスクロール表示する。

| 要素 | 仕様 |
|---|---|
| 表示件数 | 最大15件（古いものは下からフェードアウト） |
| 処理中記事 | 左側に青い光のボーダーラインが付く（アニメーション） |
| 完了記事 | センチメントラベル（POSITIVE / NEUTRAL / NEGATIVE）バッジを表示 |
| 自動スクロール | 新記事が上から追加されると既存記事が下にスライドする |
| 表示フィールド | 記事タイトル（最大60文字）、ソース種別、経過時間 |

#### 3.3.2 Watson NLU カテゴリ分類バー

直近100件の記事を集計し、トピック別の割合を横棒グラフで表示する。

| 表示トピック | 最大表示件数 |
|---|---|
| Conflict / Politics / Technology / Finance / Health / Environment / Other | 7カテゴリ |

各バーはリアルタイムに更新され、増減時にアニメーション遷移する。

#### 3.3.3 Global Tone Index

直近100件の `sentiment_score` 平均値を -1.0（NEGATIVE）〜 +1.0（POSITIVE）のスペクトルゲージで表示する。

| 値域 | カラー | ラベル |
|---|---|---|
| +0.3 〜 +1.0 | `#42be65` | POSITIVE |
| -0.3 〜 +0.3 | `#f1c21b` | NEUTRAL |
| -1.0 〜 -0.3 | `#fa4d56` | NEGATIVE |

#### 3.3.4 エンティティ・キーコンセプトカウンター

| 表示項目 | 内容 |
|---|---|
| 抽出エンティティ数 | 直近15分間で抽出されたユニークエンティティ数 |
| キーコンセプト数 | 直近15分間で検出されたユニークトピック数 |
| トップエンティティ | 最頻出エンティティ Top 5（タグクラウド形式） |

---

## 4. データソース仕様

### 4.1 共有データソース

Watson News の ETL パイプラインが生成する OpenSearch インデックスを参照する。NEURAL FEED はデータを書き込まず、**読み取り専用**で使用する。

| インデックス | 主な利用箇所 |
|---|---|
| `watson_news_enriched` | 記事キュー・分類バー・グローバルトーン・エンティティカウンター・ニューラルグラフのノードデータ |
| `watson_news_clean` | 処理パイプラインのステータスシミュレーション用 |

### 4.2 データ取得方式

| 方式 | 用途 | 更新頻度 |
|---|---|---|
| SSE（Server-Sent Events） | 新規インデックス記事のリアルタイム通知 | 即時（Polling fallback: 5秒） |
| REST API（ポーリング） | KPIメトリクス・集計値の取得 | 10秒間隔 |
| WebSocket（将来対応） | より低遅延が必要になった場合に切替 | — |

### 4.3 Watson NLPとの関係

Watson NLPの解析結果（エンティティ・トピック・センチメント等）は、**Watson News ETLパイプラインがすでにOpenSearchに格納**している。NEURAL FEEDはこれを可視化するだけであり、Watson NLP SDKを直接呼び出す必要はない。

ただし、以下の場合は Watson NLP コンテナとの直接連携を検討する:

| ケース | 対応方針 |
|---|---|
| パイプラインの処理中ステータスをリアルタイムに取得したい | Watson News バックエンドにステータスAPIを追加する（Watson NLP直接呼び出しは不要） |
| NEURAL FEED専用の軽量NLP処理（デモ用） | Watson NLP REST API（ローカルコンテナ）を経由して形態素解析結果を取得し、グラフのアニメーションに反映 |

---

## 5. 音響演出

| 項目 | 仕様 |
|---|---|
| ライブラリ | Tone.js |
| デフォルト | ミュート（展示会場のノイズ環境を考慮） |
| ノード発火音 | 低い正弦波シンセ音（100〜200Hz）、ランダムピッチで重複しても不快感がない |
| コンフリクト検出音 | やや高めの不協和音（デモモード時のみ） |
| 音量制御 | 設定パネルから 0〜100% 調整可能（管理者用） |

---

## 6. 非機能要件

### 6.1 パフォーマンス

| 要件 | 目標値 |
|---|---|
| フレームレート | 60 fps（ニューラルグラフ） |
| 同時描画ノード数 | 最大 500 ノード @ 60fps |
| 初期ロード | 10秒以内（キャッシュなし） |
| データ遅延 | 記事インデックスから画面反映まで最大15秒 |
| 連続稼働 | 8時間以上メモリリーク・クラッシュなし |

### 6.2 ブラウザ・ランタイム

| 項目 | 要件 |
|---|---|
| 推奨ブラウザ | Google Chrome 最新版（GPUアクセラレーション有効） |
| WebGL | WebGL 2.0 必須 |
| ハードウェア | GPU搭載PC推奨（NVIDIA GTX 1060以上） |
| ネットワーク | 社内LAN接続（APIサーバーと同一ネットワーク） |

### 6.3 運用・保守

| 要件 | 仕様 |
|---|---|
| デプロイ形式 | Docker コンテナ（既存 docker-compose に追加） |
| 設定変更 | 環境変数で API エンドポイント・更新頻度を制御 |
| 管理者設定 | URL パラメータ（`?admin=true`）で隠し設定パネルを表示 |
| ログ | フロントエンドエラーをバックエンドに送信してログ記録 |
| 障害時 | APIが応答しない場合はデモデータ（モックデータ）で自動フォールバック |

---

## 7. スコープ外（将来検討）

- タッチ操作インタラクション（来場者が記事を選択）
- 多言語切替（日本語 / 英語）
- QRコード表示（記事詳細へのリンク）
- カスタムテーマ（イベント別カラースキーム変更）
- WebSocket によるリアルタイム双方向通信
